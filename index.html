<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<!--
  NOTE:
  The spacing around the <title> tag is intentional.
  Safari on macOS sometimes fails to apply <meta name="theme-color">
  when the title tag is parsed too early in the head.
  Adding whitespace here ensures the correct window tint color (#2C8372)
  is consistently applied.
-->
<title>Prompt Architect            </title>
<meta name="theme-color" content="#2C8372">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1" />
  
<!-- Meta preview for WhatsApp, iMessage, Telegram, Discord, Twitter etc. -->
<meta property="og:title" content="Prompt Architect — Windows 98 Edition">
<meta property="og:description" content="A modular prompt-building tool for generative AI, built in a Windows 98-inspired interface.">
<meta property="og:image" content="https://emircanyilmaz2000-droid.github.io/Promt-Architect/Promt-Architect.jpeg">
<meta property="og:url" content="https://emircanyilmaz2000-droid.github.io/Promt-Architect/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Prompt Architect">

<!-- Twitter / X Card (used by many Android preview engines too) -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Prompt Architect — Windows 98 Edition">
<meta name="twitter:description" content="A modular prompt-building tool for generative AI, built in a Windows 98-inspired interface.">
<meta name="twitter:image" content="https://emircanyilmaz2000-droid.github.io/Promt-Architect/Promt-Architect.jpeg">

<!-- Fallback for Apple Messages / Safari -->
<meta name="image" content="https://emircanyilmaz2000-droid.github.io/Promt-Architect/Promt-Architect.jpeg">
<link rel="image_src" href="https://emircanyilmaz2000-droid.github.io/Promt-Architect/Promt-Architect.jpeg">

<!-- Optional theme color for mobile browser bar -->
<meta name="theme-color" content="#007F00">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
<style>
  @font-face {
    font-family: "Pixelated MS Sans Serif";
    font-style: normal;
    font-weight: 400;
    src: url(https://unpkg.com/98.css@0.1.21/dist/ms_sans_serif.woff) format("woff");
    src: url(https://unpkg.com/98.css@0.1.21/dist/ms_sans_serif.woff2) format("woff2");
  }
  @font-face {
    font-family: "Pixelated MS Sans Serif";
    font-style: normal;
    font-weight: 700;
    src: url(https://unpkg.com/98.css@0.1.21/dist/ms_sans_serif_bold.woff) format("woff");
    src: url(https://unpkg.com/98.css@0.1.21/dist/ms_sans_serif_bold.woff2) format("woff2");
  }
  body {
    color: #222;
    font-family: Arial;
    font-size: 12px;
  }
  .title-bar,
  .window,
  button,
  input,
  label,
  legend,
  li[role="tab"],
  option,
  select,
  table,
  textarea,
  ul.tree-view {
    -webkit-font-smoothing: none;
    font-family: "Pixelated MS Sans Serif", Arial;
    font-size: 11px;
  }
  h1,
  h2,
  h3,
  h4 {
    font-weight: 700;
  }
  h1 {
    font-size: 5rem;
  }
  h2 {
    font-size: 2.5rem;
  }
  h3 {
    font-size: 2rem;
  }
  h4 {
    font-size: 1.5rem;
  }
  u {
    border-bottom: 0.5px solid #222;
    text-decoration: none;
  }
  button,
  input[type="reset"],
  input[type="submit"] {
    background: silver;
    border: none;
    border-radius: 0;
    box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff,
      inset -2px -2px grey, inset 2px 2px #dfdfdf;
    box-sizing: border-box;
    color: transparent;
    min-height: 23px;
    min-width: 75px;
    padding: 0 12px;
    text-shadow: 0 0 #222;
  }
  button.default,
  input[type="reset"].default,
  input[type="submit"].default {
    box-shadow: inset -2px -2px #0a0a0a, inset 1px 1px #0a0a0a,
      inset 2px 2px #fff, inset -3px -3px grey, inset 3px 3px #dfdfdf;
  }
  .vertical-bar {
    background: silver;
    box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff, inset -2px -2px grey,
      inset 2px 2px #dfdfdf;
    height: 20px;
    width: 4px;
  }
  button:not(:disabled):active,
  input[type="reset"]:not(:disabled):active,
  input[type="submit"]:not(:disabled):active {
    box-shadow: inset -1px -1px #fff, inset 1px 1px #0a0a0a,
      inset -2px -2px #dfdfdf, inset 2px 2px grey;
    text-shadow: 1px 1px #222;
  }
  button.default:not(:disabled):active,
  input[type="reset"].default:not(:disabled):active,
  input[type="submit"].default:not(:disabled):active {
    box-shadow: inset 2px 2px #0a0a0a, inset -1px -1px #0a0a0a,
      inset -2px -2px #fff, inset 3px 3px grey, inset -3px -3px #dfdfdf;
  }
  @media (not(hover)) {
    button:not(:disabled):hover,
    input[type="reset"]:not(:disabled):hover,
    input[type="submit"]:not(:disabled):hover {
      box-shadow: inset -1px -1px #fff, inset 1px 1px #0a0a0a,
        inset -2px -2px #dfdfdf, inset 2px 2px grey;
    }
  }
  button:focus,
  input[type="reset"]:focus,
  input[type="submit"]:focus {
    outline: 1px dotted #000;
    outline-offset: -4px;
  }
  button::-moz-focus-inner,
  input[type="reset"]::-moz-focus-inner,
  input[type="submit"]::-moz-focus-inner {
    border: 0;
  }
  :disabled,
  :disabled + label,
  input[readonly],
  input[readonly] + label {
    color: grey;
  }
  :disabled + label,
  button:disabled,
  input[type="reset"]:disabled,
  input[type="submit"]:disabled {
    text-shadow: 1px 1px 0 #fff;
  }
  .window {
    background: silver;
    box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #dfdfdf,
      inset -2px -2px grey, inset 2px 2px #fff;
    padding: 3px;
  }
  .title-bar {
    align-items: center;
    background: linear-gradient(90deg, navy, #1084d0);
    display: flex;
    justify-content: space-between;
    padding: 3px 2px 3px 3px;
  }
  .title-bar.inactive {
    background: linear-gradient(90deg, grey, #b5b5b5);
  }
  .title-bar-text {
    color: #fff;
    font-weight: 700;
    letter-spacing: 0;
    margin-right: 24px;
  }
  .title-bar-controls {
    display: flex;
  }
  .title-bar-controls button {
    display: block;
    min-height: 14px;
    min-width: 16px;
    padding: 0;
  }
  .title-bar-controls button:active {
    padding: 0;
  }
  .title-bar-controls button:focus {
    outline: none;
  }
  .title-bar-controls button[aria-label="Minimize"],
  .title-bar-controls button[aria-label].minimize {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='6' height='2' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23000' d='M0 0h6v2H0z'/%3E%3C/svg%3E");
    background-position: bottom 3px left 4px;
    background-repeat: no-repeat;
  }
  .title-bar-controls button[aria-label="Maximize"],
  .title-bar-controls button[aria-label].maximize {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='9' height='9' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 0H0v9h9V0zM8 2H1v6h7V2z' fill='%23000'/%3E%3C/svg%3E");
    background-position: top 2px left 3px;
    background-repeat: no-repeat;
  }
  .title-bar-controls button[aria-label="Maximize"]:disabled,
  .title-bar-controls button[aria-label].maximize:disabled {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='10' height='10' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M10 1H1v9h9V1zM9 3H2v6h7V3z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 0H0v9h9V0zM8 2H1v6h7V2z' fill='gray'/%3E%3C/svg%3E");
    background-position: top 2px left 3px;
    background-repeat: no-repeat;
  }
  .title-bar-controls button[aria-label="Restore"],
  .title-bar-controls button[aria-label].restore {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='9' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23000' d='M2 0h6v2H2zM7 2h1v4H7zM2 2h1v1H2zM6 5h1v1H6zM0 3h6v2H0zM5 5h1v4H5zM0 5h1v4H0zM1 8h4v1H1z'/%3E%3C/svg%3E");
    background-position: top 2px left 3px;
    background-repeat: no-repeat;
  }
  .title-bar-controls button[aria-label="Help"],
  .title-bar-controls button[aria-label].help {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='6' height='9' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23000' d='M0 1h2v2H0zM1 0h4v1H1zM4 1h2v2H4zM3 3h2v1H3zM2 4h2v2H2zM2 7h2v2H2z'/%3E%3C/svg%3E");
    background-position: top 2px left 5px;
    background-repeat: no-repeat;
  }
  .title-bar-controls button[aria-label="Close"],
  .title-bar-controls button[aria-label].close {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='8' height='7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0h2v1h1v1h2V1h1V0h2v1H7v1H6v1H5v1h1v1h1v1h1v1H6V6H5V5H3v1H2v1H0V6h1V5h1V4h1V3H2V2H1V1H0V0z' fill='%23000'/%3E%3C/svg%3E");
    background-position: top 3px left 4px;
    background-repeat: no-repeat;
    margin-left: 2px;
  }
  .status-bar {
    gap: 1px;
    display: flex;
    margin: 0 1px;
  }
  .status-bar-field {
    box-shadow: inset -1px -1px #dfdfdf, inset 1px 1px grey;
    flex-grow: 1;
    margin: 0;
    padding: 2px 3px;
  }
  .window-body {
    margin: 8px;
  }
  fieldset {
    border-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='5' height='5' fill='gray' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0h5v5H0V2h2v1h1V2H0' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0h4v4H0V1h1v2h2V1H0'/%3E%3C/svg%3E")
      2;
    margin: 0;
    padding: 10px;
    padding-block-start: 8px;
  }
  legend {
    background: silver;
  }
  .field-row {
    align-items: center;
    display: flex;
  }
  [class^="field-row"] + [class^="field-row"] {
    margin-top: 6px;
  }
  .field-row > * + * {
    margin-left: 6px;
  }
  .field-row-stacked {
    display: flex;
    flex-direction: column;
  }
  .field-row-stacked > * + * {
    margin-top: 6px;
  }
  label {
    align-items: center;
    display: inline-flex;
    user-select: none;
  }
  input[type="checkbox"],
  input[type="radio"] {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background: 0;
    border: none;
    margin: 0;
    opacity: 0;
    position: fixed;
  }
  input[type="checkbox"] + label,
  input[type="radio"] + label {
    line-height: 13px;
  }
  input[type="radio"] + label {
    margin-left: 18px;
    position: relative;
  }
  input[type="radio"] + label:before {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 0H4v1H2v1H1v2H0v4h1v2h1V8H1V4h1V2h2V1h4v1h2V1H8V0z' fill='gray'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 1H4v1H2v2H1v4h1v1h1V8H2V4h1V3h1V2h4v1h2V2H8V1z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 3h1v1H9V3zm1 5V4h1v4h-1zm-2 2V9h1V8h1v2H8zm-4 0v1h4v-1H4zm0 0V9H2v1h2z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 2h-1v2h1v4h-1v2H8v1H4v-1H2v1h2v1h4v-1h2v-1h1V8h1V4h-1V2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M4 2h4v1h1v1h1v4H9v1H8v1H4V9H3V8H2V4h1V3h1V2z' fill='silver'/%3E%3C/svg%3E");
    content: "";
    display: inline-block;
    height: 12px;
    left: -18px;
    margin-right: 6px;
    position: absolute;
    top: 0;
    width: 12px;
  }
  input[type="radio"]:active + label:before {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 0H4v1H2v1H1v2H0v4h1v2h1V8H1V4h1V2h2V1h4v1h2V1H8V0z' fill='gray'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 1H4v1H2v2H1v4h1v1h1V8H2V4h1V3h1V2h4v1h2V2H8V1z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 3h1v1H9V3zm1 5V4h1v4h-1zm-2 2V9h1V8h1v2H8zm-4 0v1h4v-1H4zm0 0V9H2v1h2z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 2h-1v2h1v4h-1v2H8v1H4v-1H2v1h2v1h4v-1h2v-1h1V8h1V4h-1V2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M4 2h4v1h1v1h1v4H9v1H8v1H4V9H3V8H2V4h1V3h1V2z' fill='silver'/%3E%3C/svg%3E");
  }
  input[type="radio"]:checked + label:after {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='4' height='4' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3 0H1v1H0v2h1v1h2V3h1V1H3V0z' fill='%23000'/%3E%3C/svg%3E");
    content: "";
    display: block;
    height: 4px;
    left: -14px;
    position: absolute;
    top: 4px;
    width: 4px;
  }
  input[type="checkbox"]:focus + label,
  input[type="radio"]:focus + label {
    outline: 1px dotted #000;
  }
  input[type="radio"][disabled] + label:before {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 0H4v1H2v1H1v2H0v4h1v2h1V8H1V4h1V2h2V1h4v1h2V1H8V0z' fill='gray'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 1H4v1H2v2H1v4h1v1h1V8H2V4h1V3h1V2h4v1h2V2H8V1z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 3h1v1H9V3zm1 5V4h1v4h-1zm-2 2V9h1V8h1v2H8zm-4 0v1h4v-1H4zm0 0V9H2v1h2z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 2h-1v2h1v4h-1v2H8v1H4v-1H2v1h2v1h4v-1h2v-1h1V8h1V4h-1V2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M4 2h4v1h1v1h1v4H9v1H8v1H4V9H3V8H2V4h1V3h1V2z' fill='silver'/%3E%3C/svg%3E");
  }
  input[type="radio"][disabled]:checked + label:after {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='4' height='4' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3 0H1v1H0v2h1v1h2V3h1V1H3V0z' fill='gray'/%3E%3C/svg%3E");
  }
  input[type="checkbox"] + label {
    margin-left: 19px;
    position: relative;
  }
  input[type="checkbox"] + label:before {
    background: #fff;
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    content: "";
    display: inline-block;
    height: 13px;
    left: -19px;
    margin-right: 6px;
    position: absolute;
    width: 13px;
  }
  input[type="checkbox"]:active + label:before {
    background: silver;
  }
  input[type="checkbox"]:checked + label:after {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='7' height='7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M7 0H6v1H5v1H4v1H3v1H2V3H1V2H0v3h1v1h1v1h1V6h1V5h1V4h1V3h1V0z' fill='%23000'/%3E%3C/svg%3E");
    content: "";
    display: block;
    height: 7px;
    left: -16px;
    position: absolute;
    width: 7px;
  }
  input[type="checkbox"][disabled] + label:before {
    background: silver;
  }
  input[type="checkbox"][disabled]:checked + label:after {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='7' height='7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M7 0H6v1H5v1H4v1H3v1H2V3H1V2H0v3h1v1h1v1h1V6h1V5h1V4h1V3h1V0z' fill='gray'/%3E%3C/svg%3E");
  }
  input[type="email"],
  input[type="number"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="text"],
  input[type="url"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: none;
    border-radius: 0;
  }
  input[type="email"],
  input[type="number"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="text"],
  input[type="url"],
  select {
    background-color: #fff;
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    box-sizing: border-box;
    padding: 3px 4px;
  }
  select,
  textarea {
    border: none;
  }
  textarea {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-color: #fff;
    border-radius: 0;
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    box-sizing: border-box;
    padding: 3px 4px;
  }
  input[type="email"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="text"],
  input[type="url"],
  select {
    height: 21px;
  }
  input[type="number"] {
    height: 22px;
  }
  input[type="search"]::-ms-clear,
  input[type="search"]::-ms-reveal {
    display: none;
    height: 0;
    width: 0;
  }
  input[type="search"]::-webkit-search-cancel-button,
  input[type="search"]::-webkit-search-decoration,
  input[type="search"]::-webkit-search-results-button,
  input[type="search"]::-webkit-search-results-decoration {
    display: none;
  }
  input[type="email"],
  input[type="number"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="text"],
  input[type="url"] {
    line-height: 2;
  }
  input[type="email"]:disabled,
  input[type="email"]:read-only,
  input[type="number"]:disabled,
  input[type="number"]:read-only,
  input[type="password"]:disabled,
  input[type="password"]:read-only,
  input[type="search"]:disabled,
  input[type="search"]:read-only,
  input[type="tel"]:disabled,
  input[type="tel"]:read-only,
  input[type="text"]:disabled,
  input[type="text"]:read-only,
  input[type="url"]:disabled,
  input[type="url"]:read-only,
  textarea:disabled {
    background-color: silver;
  }
  select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 0H0v16h1V1h14V0z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 1H1v14h1V2h12V1H2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 17H0v-1h15V0h1v17z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 1h-1v14H1v1h14V1z' fill='gray'/%3E%3Cpath fill='silver' d='M2 2h12v13H2z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 6H4v1h1v1h1v1h1v1h1V9h1V8h1V7h1V6z' fill='%23000'/%3E%3C/svg%3E");
    background-position: top 2px right 2px;
    background-repeat: no-repeat;
    border-radius: 0;
    padding-right: 32px;
    position: relative;
  }
  input[type="email"]:focus,
  input[type="number"]:focus,
  input[type="password"]:focus,
  input[type="search"]:focus,
  input[type="tel"]:focus,
  input[type="text"]:focus,
  input[type="url"]:focus,
  select:focus,
  textarea:focus {
    outline: none;
  }
  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
    width: 100%;
  }
  input[type="range"]:focus {
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='11' height='21' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0v16h2v2h2v2h1v-1H3v-2H1V1h9V0z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M1 1v15h1v1h1v1h1v1h2v-1h1v-1h1v-1h1V1z' fill='%23C0C7C8'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 1h1v15H8v2H6v2H5v-1h2v-2h2z' fill='%2387888F'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M10 0h1v16H9v2H7v2H5v1h1v-2h2v-2h2z' fill='%23000'/%3E%3C/svg%3E");
    border: none;
    border-radius: 0;
    height: 21px;
    transform: translateY(-8px);
    width: 11px;
  }
  input[type="range"].has-box-indicator::-webkit-slider-thumb {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='11' height='21' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0v20h1V1h9V0z' fill='%23fff'/%3E%3Cpath fill='%23C0C7C8' d='M1 1h8v18H1z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 1h1v19H1v-1h8z' fill='%2387888F'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M10 0h1v21H0v-1h10z' fill='%23000'/%3E%3C/svg%3E");
    transform: translateY(-10px);
  }
  input[type="range"]::-moz-range-thumb {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='11' height='21' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0v16h2v2h2v2h1v-1H3v-2H1V1h9V0z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M1 1v15h1v1h1v1h1v1h2v-1h1v-1h1v-1h1V1z' fill='%23C0C7C8'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 1h1v15H8v2H6v2H5v-1h2v-2h2z' fill='%2387888F'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M10 0h1v16H9v2H7v2H5v1h1v-2h2v-2h2z' fill='%23000'/%3E%3C/svg%3E");
    border: 0;
    border-radius: 0;
    height: 21px;
    transform: translateY(2px);
    width: 11px;
  }
  input[type="range"].has-box-indicator::-moz-range-thumb {
    background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='11' height='21' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0v20h1V1h9V0z' fill='%23fff'/%3E%3Cpath fill='%23C0C7C8' d='M1 1h8v18H1z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 1h1v19H1v-1h8z' fill='%2387888F'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M10 0h1v21H0v-1h10z' fill='%23000'/%3E%3C/svg%3E");
    transform: translateY(0);
  }
  input[type="range"]::-webkit-slider-runnable-track {
    background: #000;
    border-bottom: 1px solid grey;
    border-right: 1px solid grey;
    box-shadow: 1px 0 0 #fff, 1px 1px 0 #fff, 0 1px 0 #fff, -1px 0 0 #a9a9a9,
      -1px -1px 0 #a9a9a9, 0 -1px 0 #a9a9a9, -1px 1px 0 #fff, 1px -1px #a9a9a9;
    box-sizing: border-box;
    height: 2px;
    width: 100%;
  }
  input[type="range"]::-moz-range-track {
    background: #000;
    border-bottom: 1px solid grey;
    border-right: 1px solid grey;
    box-shadow: 1px 0 0 #fff, 1px 1px 0 #fff, 0 1px 0 #fff, -1px 0 0 #a9a9a9,
      -1px -1px 0 #a9a9a9, 0 -1px 0 #a9a9a9, 1px 1px 0 #fff, -1px -1px #a9a9a9;
    box-sizing: border-box;
    height: 2px;
    width: 100%;
  }
  .is-vertical {
    display: inline-block;
    height: 150px;
    transform: translateY(50%);
    width: 4px;
  }
  .is-vertical > input[type="range"] {
    height: 4px;
    margin: 0 16px 0 10px;
    transform: rotate(270deg) translateX(calc(-50% + 8px));
    transform-origin: left;
    width: 150px;
  }
  .is-vertical > input[type="range"]::-webkit-slider-runnable-track {
    border-bottom: 1px solid grey;
    border-left: 1px solid grey;
    border-right: 0;
    box-shadow: -1px 0 0 #fff, -1px 1px 0 #fff, 0 1px 0 #fff, 1px 0 0 #a9a9a9,
      1px -1px 0 #a9a9a9, 0 -1px 0 #a9a9a9, 1px 1px 0 #fff, -1px -1px #a9a9a9;
  }
  .is-vertical > input[type="range"]::-moz-range-track {
    border-bottom: 1px solid grey;
    border-left: 1px solid grey;
    border-right: 0;
    box-shadow: -1px 0 0 #fff, -1px 1px 0 #fff, 0 1px 0 #fff, 1px 0 0 #a9a9a9,
      1px -1px 0 #a9a9a9, 0 -1px 0 #a9a9a9, 1px 1px 0 #fff, -1px -1px #a9a9a9;
  }
  .is-vertical > input[type="range"]::-webkit-slider-thumb {
    transform: translateY(-8px) scaleX(-1);
  }
  .is-vertical > input[type="range"].has-box-indicator::-webkit-slider-thumb {
    transform: translateY(-10px) scaleX(-1);
  }
  .is-vertical > input[type="range"]::-moz-range-thumb {
    transform: translateY(2px) scaleX(-1);
  }
  .is-vertical > input[type="range"].has-box-indicator::-moz-range-thumb {
    transform: translateY(0) scaleX(-1);
  }
  select:focus {
    background-color: navy;
    color: #fff;
  }
  select:focus option {
    background-color: #fff;
    color: #000;
  }
  select:active {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 0h16v17H0V0zm1 16h14V1H1v15z' fill='gray'/%3E%3Cpath fill='silver' d='M1 1h14v15H1z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M12 7H5v1h1v1h1v1h1v1h1V9h1V8h1V7h1V6z' fill='%23000'/%3E%3C/svg%3E");
  }
  a {
    color: #00f;
  }
  a:focus {
    outline: 1px dotted #00f;
  }
  ul.tree-view {
    background: #fff;
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    display: block;
    margin: 0;
    padding: 6px;
  }
  ul.tree-view li {
    list-style-type: none;
  }
  ul.tree-view a {
    color: #000;
    text-decoration: none;
  }
  ul.tree-view a:focus {
    background-color: navy;
    color: #fff;
  }
  ul.tree-view li,
  ul.tree-view ul {
    margin-top: 3px;
  }
  ul.tree-view ul {
    border-left: 1px dotted grey;
    margin-left: 16px;
    padding-left: 16px;
  }
  ul.tree-view ul > li {
    position: relative;
  }
  ul.tree-view ul > li:before {
    border-bottom: 1px dotted grey;
    content: "";
    display: block;
    left: -16px;
    position: absolute;
    top: 6px;
    width: 12px;
  }
  ul.tree-view ul > li:last-child:after {
    background: #fff;
    bottom: 0;
    content: "";
    display: block;
    left: -20px;
    position: absolute;
    top: 7px;
    width: 8px;
  }
  ul.tree-view details {
    margin-top: 0;
  }
  ul.tree-view details[open] summary {
    margin-bottom: 0;
  }
  ul.tree-view ul details > summary:before {
    margin-left: -22px;
    position: relative;
    z-index: 1;
  }
  ul.tree-view details > summary:before {
    background-color: #fff;
    border: 1px solid grey;
    content: "+";
    display: block;
    float: left;
    height: 9px;
    line-height: 8px;
    margin-right: 5px;
    padding-left: 1px;
    text-align: center;
    width: 8px;
  }
  ul.tree-view details[open] > summary:before {
    content: "-";
  }
  ul.tree-view details > summary::-webkit-details-marker,
  ul.tree-view details > summary::marker {
    content: "";
  }
  pre {
    background: #fff;
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    display: block;
    margin: 0;
    padding: 12px 8px;
  }
  code,
  code * {
    font-family: monospace;
  }
  summary:focus {
    outline: 1px dotted #000;
  }
  ::-webkit-scrollbar {
    width: 16px;
  }
  ::-webkit-scrollbar:horizontal {
    height: 17px;
  }
  ::-webkit-scrollbar-corner {
    background: #dfdfdf;
  }
  ::-webkit-scrollbar-track {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='2' height='2' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M1 0H0v1h1v1h1V1H1V0z' fill='silver'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 0H1v1H0v1h1V1h1V0z' fill='%23fff'/%3E%3C/svg%3E");
  }
  ::-webkit-scrollbar-thumb {
    background-color: #dfdfdf;
    box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff,
      inset -2px -2px grey, inset 2px 2px #dfdfdf;
  }
  ::-webkit-scrollbar-button:horizontal:end:increment,
  ::-webkit-scrollbar-button:horizontal:start:decrement,
  ::-webkit-scrollbar-button:vertical:end:increment,
  ::-webkit-scrollbar-button:vertical:start:decrement {
    display: block;
  }
  ::-webkit-scrollbar-button:vertical:start {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 0H0v16h1V1h14V0z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 1H1v14h1V2h12V1H2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 17H0v-1h15V0h1v17z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 1h-1v14H1v1h14V1z' fill='gray'/%3E%3Cpath fill='silver' d='M2 2h12v13H2z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 6H7v1H6v1H5v1H4v1h7V9h-1V8H9V7H8V6z' fill='%23000'/%3E%3C/svg%3E");
    height: 17px;
  }
  ::-webkit-scrollbar-button:vertical:end {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 0H0v16h1V1h14V0z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 1H1v14h1V2h12V1H2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 17H0v-1h15V0h1v17z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 1h-1v14H1v1h14V1z' fill='gray'/%3E%3Cpath fill='silver' d='M2 2h12v13H2z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 6H4v1h1v1h1v1h1v1h1V9h1V8h1V7h1V6z' fill='%23000'/%3E%3C/svg%3E");
    height: 17px;
  }
  ::-webkit-scrollbar-button:horizontal:start {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 0H0v16h1V1h14V0z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 1H1v14h1V2h12V1H2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 17H0v-1h15V0h1v17z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 1h-1v14H1v1h14V1z' fill='gray'/%3E%3Cpath fill='silver' d='M2 2h12v13H2z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M9 4H8v1H7v1H6v1H5v1h1v1h1v1h1v1h1V4z' fill='%23000'/%3E%3C/svg%3E");
    width: 16px;
  }
  ::-webkit-scrollbar-button:horizontal:end {
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='17' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 0H0v16h1V1h14V0z' fill='%23DFDFDF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M2 1H1v14h1V2h12V1H2z' fill='%23fff'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M16 17H0v-1h15V0h1v17z' fill='%23000'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M15 1h-1v14H1v1h14V1z' fill='gray'/%3E%3Cpath fill='silver' d='M2 2h12v13H2z'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M7 4H6v7h1v-1h1V9h1V8h1V7H9V6H8V5H7V4z' fill='%23000'/%3E%3C/svg%3E");
    width: 16px;
  }
  .window[role="tabpanel"] {
    position: relative;
    z-index: 2;
  }
  menu[role="tablist"] {
    display: flex;
    list-style-type: none;
    margin: 0 0 -2px;
    padding-left: 3px;
    position: relative;
    text-indent: 0;
  }
  menu[role="tablist"] > li {
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    box-shadow: inset -1px 0 #0a0a0a, inset 1px 1px #dfdfdf,
      inset -2px 0 grey, inset 2px 2px #fff;
    z-index: 1;
  }
  menu[role="tablist"] > li[aria-selected="true"] {
    background-color: silver;
    margin-left: -3px;
    margin-top: -2px;
    padding-bottom: 2px;
    position: relative;
    z-index: 8;
  }
  menu[role="tablist"] > li > a {
    color: #222;
    display: block;
    margin: 6px;
    text-decoration: none;
  }
  menu[role="tablist"] > li[aria-selected="true"] > a:focus {
    outline: none;
  }
  menu[role="tablist"] > li > a:focus {
    outline: 1px dotted #222;
  }
  menu[role="tablist"].multirows > li {
    flex-grow: 1;
    text-align: center;
  }
  .sunken-panel {
    border: 2px groove transparent;
    border-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='5' height='5' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='gray' d='M0 0h4v1H0z'/%3E%3Cpath fill='gray' d='M0 0h1v4H0z'/%3E%3Cpath fill='%230a0a0a' d='M1 1h2v1H1z'/%3E%3Cpath fill='%230a0a0a' d='M1 1h1v2H1z'/%3E%3Cpath fill='%23fff' d='M0 4h5v1H0z'/%3E%3Cpath fill='%23fff' d='M4 0h1v5H4z'/%3E%3Cpath fill='%23dfdfdf' d='M3 1h1v3H3z'/%3E%3Cpath fill='%23dfdfdf' d='M1 3h3v1H1z'/%3E%3C/svg%3E")
      2;
    box-sizing: border-box;
    overflow: auto;
  }
  .sunken-panel,
  table {
    background-color: #fff;
  }
  table {
    border-collapse: collapse;
    position: relative;
    text-align: left;
    white-space: nowrap;
  }
  table > thead > tr > * {
    background: silver;
    box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff,
      inset -2px -2px grey, inset 2px 2px #dfdfdf;
    box-sizing: border-box;
    font-weight: 400;
    height: 17px;
    padding: 0 6px;
    position: sticky;
    top: 0;
  }
  table.interactive > tbody > tr {
    cursor: pointer;
  }
  table > tbody > tr.highlighted {
    background-color: navy;
    color: #fff;
  }
table > tbody > tr > * {
    height: 14px;
    padding: 0 6px;
  }
  .progress-indicator {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: none;
    border-radius: 0;
    box-shadow: inset -2px -2px #dfdfdf, inset 2px 2px grey;
    box-sizing: border-box;
    height: 32px;
    padding: 4px;
    position: relative;
  }
  .progress-indicator > .progress-indicator-bar {
    background-color: navy;
    display: block;
    height: 100%;
  }
  .progress-indicator.segmented > .progress-indicator-bar {
    background-color: transparent;
    background-image: linear-gradient(90deg, navy 16px, transparent 0 2px);
    background-repeat: repeat;
    background-size: 18px 100%;
    width: 100%;
  }
  .field-border {
    background: #fff;
  }
  .field-border,
  .field-border-disabled {
    box-shadow: inset -1px -1px #fff, inset 1px 1px grey,
      inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    padding: 2px;
  }
  .field-border-disabled {
    background: silver;
  }
  .status-field-border {
    background: silver;
    box-shadow: inset -1px -1px #dfdfdf, inset 1px 1px grey;
    padding: 1px;
  }
</style>
<style>
  /* Segoe UI font for content elements (more consistent rendering) */
  body, input, textarea, select, .panel, label, .menubar, .menu, .dropdown, .item, legend, fieldset, .status-bar {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  }
  
  /* Segoe UI for action buttons only */
  .action-buttons button, button[data-action] {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  }
  
  /* Font weights and sizes */
  legend {
    font-weight: 600 !important;
    font-size: 14px !important;
  }
  .menubar, .menu, .dropdown, .item {
    font-size: 13px !important;
    font-weight: 400 !important;
  }
  button {
    font-size: 13px !important;
    font-weight: 500 !important;
  }
  label {
    font-weight: 400 !important;
  }
  input, textarea, select {
    font-weight: 400 !important;
  }
  :root { --gap: 12px; }
  html,body { height:100%; }
  * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body { 
    margin:0; 
    background:#01817d; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
    display:flex; 
    align-items:flex-start; 
    justify-content:center; 
    padding-top:12px;
    text-rendering: optimizeLegibility;
  }
  /* Keep entire window visible on laptop screens; internal areas scroll */
  .window { 
    width:min(1600px, calc(100% - 24px)); 
    max-width:1600px; 
    /* Allow page to scroll instead of inner panes */
    max-height:none;
    margin:12px; 
    display:flex; 
    flex-direction:column; 
  }
  .window.maximized { 
    width:calc(100vw - 24px); 
    /* Auto height so the whole page scrolls */
    height:auto; 
    max-width:none; 
    max-height:none; 
    margin:12px;
    display:flex;
    flex-direction:column;
  }
  /* Ensure window body participates in flex sizing (for maximize) */
  .window-body { padding:0 !important; display:block; min-height:0; }
  .window.maximized .window-body { flex:1; display:flex; flex-direction:column; min-height:0; }
  .window .window-body { flex:1; overflow:visible; display:flex; flex-direction:column; min-height:0; }
  .window.maximized .window-body { flex:1; overflow:visible; }
  .window.maximized .grid { 
    grid-template-columns:1fr 1fr;
    flex:1;
    height:auto;
    min-height:0;
  }
  .window .grid { flex:1; min-height:0; }
  .window .grid > div { overflow:visible; min-height:0; }

  /* Menu bar */
  .menubar{display:flex;gap:14px;padding:4px 6px;user-select:none;background:#c0c0c0;border-bottom:2px solid #fff;box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf;font-size:13px}
  .menu{position:relative}
  .menu>[data-toggle]{all:unset;padding:2px 6px;cursor:default}
  .menu>[data-toggle]:hover,.menu.open>[data-toggle]{background:#000080;color:#fff}
  .menu.open>[data-toggle]{box-shadow:inset 1px 1px 0 #0a0a0a, inset -1px -1px 0 #fff;}
  .dropdown{display:none;position:absolute;top:100%;left:0;min-width:260px;background:#f1f1f1;z-index:10000;border:2px solid #fff;box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf;max-height:calc(100vh - 60px);overflow-y:auto;}
  .menu.open .dropdown{display:block}
  
  @media (max-width:768px){
    .dropdown{min-width:240px;max-width:90vw;}
    .menu:nth-child(4) .dropdown,
    .menu:nth-child(5) .dropdown{left:auto;right:0;}
  }
  .item{padding:6px 10px;display:flex;justify-content:space-between;gap:16px;cursor:default}
  .item:hover{background:#000080;color:#fff}
  .sep{height:2px;margin:4px 0;background:#c0c0c0;box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf}
  .shortcut{opacity:.7}

  /* Layout */
  .grid{display:grid;grid-template-columns:1.05fr 0.95fr;gap:var(--gap);padding:var(--gap)}
  fieldset{margin:0;padding:16px;margin-top:8px;}
  legend{
    padding:0 8px;
    margin-bottom:8px;
  }
  .row{display:grid;grid-template-columns:110px 1fr;align-items:start;gap:8px;margin:10px 0}
  input,textarea,select{
    width:100%; 
    box-sizing:border-box; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", "SF Pro Display", Roboto, "Helvetica Neue", Arial, sans-serif; 
    font-size:13px;
    padding:4px 6px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  input,textarea{
    border:none;
    box-shadow:inset -1px -1px #fff, inset 1px 1px #808080, inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    background:#fff;
  }
  /* All text inputs - single line by default but can expand */
  input[type="text"]{
    height: 30px;
    min-height: 30px;
    line-height: 1.5;
    overflow-y: auto;
    overflow-x: hidden;
  }
  /* All textareas - enable text wrapping and auto-grow */
  textarea{
    width: 100% !important;
    max-width: 100% !important;
    min-height: 30px !important;
    line-height: 1.5 !important; 
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    white-space: pre-wrap !important;
    box-sizing: border-box !important;
    resize: none !important;
    overflow: hidden !important;
    overflow-x: hidden !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
    font-size: 13px !important;
    padding: 4px 6px !important;
  }
  input::placeholder,textarea::placeholder{color:#6e6e6e;opacity:.9}
  label{font-size:13px;font-weight:500;}
  .panel{padding:12px;background:#fff;border:2px solid #fff;box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", "SF Pro Display", Roboto, "Helvetica Neue", Arial, sans-serif;line-height:1.6;font-size:13px;}
  .right{display:flex;flex-direction:column;gap:var(--gap)}
  .right .panel{
    overflow-y:auto;
    overflow-x:hidden;
  }
  .right fieldset{
    overflow:visible;
  }
  /* Custom scrollbar with single buttons (no duplication) */
  ::-webkit-scrollbar-button{
    height:17px;
    width:17px;
    background:#c0c0c0;
    border:1px solid;
    border-color:#fff #000 #000 #fff;
    box-shadow:inset 1px 1px 0 #dfdfdf, inset -1px -1px 0 #808080;
  }
  ::-webkit-scrollbar-button:active{
    border-color:#808080;
    box-shadow: inset 1px 1px 0 #0a0a0a, inset -1px -1px 0 #dfdfdf;
    background-position: calc(50% + 1px) calc(50% + 1px);
  }
  ::-webkit-scrollbar-button:vertical:decrement{
    background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8 6 L4 10 L12 10 Z" fill="%23000"/></svg>');
    background-repeat:no-repeat;
    background-position:center;
  }
  ::-webkit-scrollbar-button:vertical:increment{
    background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8 10 L4 6 L12 6 Z" fill="%23000"/></svg>');
    background-repeat:no-repeat;
    background-position:center;
  }
  ::-webkit-scrollbar-button:vertical:start:increment,
  ::-webkit-scrollbar-button:vertical:end:decrement{
    display:none !important;
    height:0 !important;
  }
  ::-webkit-scrollbar{
    width:17px;
  }
  ::-webkit-scrollbar-track{
    background:#dfdfdf;
  }
  ::-webkit-scrollbar-thumb{
    background:#c0c0c0;
    border:1px solid;
    border-color:#fff #000 #000 #fff;
    box-shadow:inset 1px 1px 0 #dfdfdf, inset -1px -1px 0 #808080;
  }

  /* Responsive heights for right-side panels (desktop scaling) */
  .panel-preview{ height:clamp(180px, 28vh, 360px); }
  .panel-structure{ height:clamp(110px, 16vh, 220px); }
  .panel-cheatsheet{ height:clamp(120px, 18vh, 260px); }

  /* Bottom toolbar fixed inside the app window */
  .action-toolbar{
    background:#c0c0c0;
    border-top:2px solid #fff;
    box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf;
  }
  .action-toolbar .action-buttons{ display:flex; gap:8px; padding:8px; }

  /* --- Desktop-only custom 98-style dropdowns for Realism & Platform --- */
  .dd98{ position:relative; display:none; width:100%; }
  .dd98-btn{
    all:unset; cursor:default; display:flex; align-items:center; width:100%; position:relative;
    background:#fff; color:#000; padding:4px 2px 4px 6px; font-size:13px;
    box-shadow:inset -1px -1px #fff, inset 1px 1px #808080, inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a;
    line-height:1.4; box-sizing:border-box; height:26px;
  }
  .dd98-btn .dd-label{ 
    flex:1; display:flex; align-items:center;
  }
  .dd98-btn .dd-caret{
    width:18px; 
    height:18px;
    background:#c0c0c0; 
    display:flex; align-items:center; justify-content:center; flex-shrink:0;
    box-shadow:inset -1px -1px 0 #0a0a0a, inset 1px 1px 0 #dfdfdf, inset -2px -2px 0 #808080, inset 2px 2px 0 #fff;
  }
  .dd98-btn .dd-caret::before{
    content:""; 
    width:0; 
    height:0; 
    border-left:3px solid transparent; 
    border-right:3px solid transparent; 
    border-top:3px solid #000;
  }
  .dd98.open .dd98-btn{
    background:#000080; color:#fff;
  }
  .dd98.open .dd98-btn .dd-caret{
    box-shadow:inset 1px 1px 0 #0a0a0a, inset -1px -1px 0 #fff;
  }
  .dd98-menu{
    position:absolute; left:-2px; right:-2px; top:calc(100% - 2px);
    background:#fff; z-index:10050;
    border:1px solid #000;
    box-shadow: 2px 2px 1px rgba(0,0,0,0.3);
    max-height:200px; overflow-y:auto; display:none;
    padding:0;
    margin-top:-1px;
  }
  .dd98.open .dd98-menu{ display:block; }
  .dd98.up .dd98-menu{ top:auto; bottom:calc(100% - 2px); margin-top:0; margin-bottom:-1px; }
  .dd98-menu li{ 
    list-style:none; padding:5px 8px; cursor:default; 
    font-size:13px; line-height:1.4; background:#fff; color:#000;
  }
  .dd98-menu li:hover{ background:#b9d7ff; color:#000; }
  .dd98-menu li[aria-selected="true"]{ background:#b9d7ff; color:#000; }

  @media (min-width:1181px){
    /* Show custom dropdowns and hide native selects on desktop */
    .dd98{ display:block; }
    #realism, #platform{ display:none; }
  }

  /* Inline action bar for tablet/mobile between Platform and Preview */
  .action-inline-mobile{ display:none; }
  .action-inline-mobile .action-buttons{ display:flex; gap:8px; padding:8px; }
  @media (max-width:1180px){
    .action-inline-mobile{ display:block; background:#c0c0c0; border-top:2px solid #fff; box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf; }
    .action-toolbar{ display:none; }
  }

  /* Action buttons + status */
  .action-buttons{display:flex;gap:8px;padding:8px;margin-top:12px;}
  .status-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;background:#c0c0c0;border-top:2px solid #fff;box-shadow:inset -1px -1px #000, inset 1px 1px #dfdfdf;font-size:13px}

  @media (max-width:1180px){
    body{align-items:flex-start; padding-top:12px;}
    .window{width:calc(100% - 24px);}
    .grid{grid-template-columns:1fr;}
    #btnMaximize{display:none !important}
    /* Mobile: Stack labels above inputs */
    .row{
      grid-template-columns:1fr;
      gap:6px;
    }
    /* Make inputs grow automatically with content on mobile/tablet */
    input[type="text"] {
      height: auto;
      min-height: 32px;
      overflow: hidden;
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      resize: vertical;
      line-height: 1.5;
      padding: 6px 8px;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
      line-height: 1.5;
      padding: 6px 8px;
    }
    select {
      min-height: 22px;
      overflow: visible;
      word-wrap: break-word;
    }
    /* Live Preview panel grows with content on mobile/tablet */
    .panel-preview {
      height: auto !important;
      min-height: 120px;
      max-height: none !important;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.6;
    }
    #preview {
      height: auto !important;
      min-height: 120px;
    }
  }

  /* Desktop: restore contained window with internal scrolling */
  @media (min-width:1181px){
    body{ align-items:center; padding-top:0; }
    .window{ max-height:calc(100vh - 24px); }
    .window.maximized{ height:calc(100vh - 24px); }
    .window .window-body{ overflow:hidden; }
    .window.maximized .window-body{ overflow:hidden; }
    .window .grid > div:not(.right){ overflow-y:auto; }
    .window.maximized .grid > div:not(.right){ overflow-y:auto; height:100%; }
    .window .grid .right{ overflow-y:visible; }
    .window.maximized .grid .right{ overflow-y:visible; height:100%; }
    /* Tight mode: reduce right-side panel sizes when the column needs to scroll */
    .right.right-tight{ gap:8px; }
    .right.right-tight .panel{ padding:6px; }
    .right.right-tight .panel-preview{ height:clamp(160px, 24vh, 320px); }
    .right.right-tight .panel-structure{ height:clamp(56px, 9vh, 120px); }
    .right.right-tight .panel-cheatsheet{ height:clamp(96px, 14vh, 200px); }
  }

  /* ---------- modals ---------- */
    </style>
  </head>
  <body>
<div class="window">
  <div class="title-bar">
    <div class="title-bar-text">Prompt Architect</div>
    <div class="title-bar-controls">
      <button aria-label="Minimize"></button>
      <button aria-label="Maximize" id="btnMaximize"></button>
  <button aria-label="Close" id="mainClose"></button>
    </div>
  </div>

  <!-- Menubar -->
  <nav class="menubar" id="menubar">
    <div class="menu" data-menu>
      <button data-toggle>File</button>
      <div class="dropdown">
        <div class="item" data-action="new">New / Clear <span class="shortcut">⌘N / Ctrl N</span></div>
        <div class="item" data-action="save">Export Prompt (.txt) <span class="shortcut">⌘S / Ctrl S</span></div>
        <div class="item" data-action="copy">Copy to Clipboard <span class="shortcut">⌘C / Ctrl C</span></div>
        <div class="sep"></div>
        <div class="item" data-action="about">App Info <span class="shortcut">⌘I / Ctrl I</span></div>
      </div>
    </div>
    <div class="menu" data-menu>
      <button data-toggle>Edit</button>
      <div class="dropdown">
        <div class="item" data-action="undo">Undo <span class="shortcut">⌘Z / Ctrl Z</span></div>
        <div class="item" data-action="redo">Redo <span class="shortcut">⌘Y / Ctrl Y</span></div>
      </div>
    </div>
    <div class="menu" data-menu>
      <button data-toggle>Templates</button>
      <div class="dropdown">
        <div class="item" data-tpl="editorial">Editorial Product Shot <span class="shortcut">⌘1 / Ctrl 1</span></div>
        <div class="item" data-tpl="fashion">Fashion Studio / Model <span class="shortcut">⌘2 / Ctrl 2</span></div>
        <div class="item" data-tpl="architectural">Architectural Exterior <span class="shortcut">⌘3 / Ctrl 3</span></div>
        <div class="item" data-tpl="artistic">Artistic / Concept <span class="shortcut">⌘4 / Ctrl 4</span></div>
        <div class="item" data-tpl="lifestyle">Lifestyle / Everyday <span class="shortcut">⌘5 / Ctrl 5</span></div>
      </div>
    </div>
    <div class="menu" data-menu>
      <button data-toggle>Generate</button>
      <div class="dropdown">
        <div class="item" data-action="randomize">Randomize Moods <span class="shortcut">⌘R / Ctrl R</span></div>
        <div class="item" data-action="normalize">Normalize Language <span class="shortcut">⌘L / Ctrl L</span></div>
        <div class="item" data-action="tighten">Tighten <span class="shortcut">⌘T / Ctrl T</span></div>
        <div class="item" data-action="expand">Expand <span class="shortcut">⌘E / Ctrl E</span></div>
      </div>
    </div>
    <div class="menu" data-menu>
      <button data-toggle>Help</button>
      <div class="dropdown">
        <div class="item" data-action="guide">Prompt Structure Guide <span class="shortcut">⌘H / Ctrl H</span></div>
      </div>
    </div>
  </nav>

  <!-- Body -->
  <div class="window-body">
  <div class="grid">
    <!-- Left -->
    <div>
      <fieldset><legend>Subject &amp; Action</legend>
        <div class="row"><label>Subject</label><textarea id="subject" placeholder="Dalmatian dog, perfume bottle, brutalist facade"></textarea></div>
        <div class="row"><label>Action</label><textarea id="action" placeholder="standing, leaping, staged on a plinth"></textarea></div>
  <div class="row"><label>Keywords</label><textarea id="altNames" placeholder="black and white coat, refraction, raw concrete"></textarea></div>
      </fieldset>

      <fieldset><legend>Setting &amp; Environment</legend>
        <div class="row"><label>Setting</label><textarea id="setting" placeholder="studio backdrop, urban exterior, alpine meadow"></textarea></div>
  <div class="row"><label>Enviroment</label><textarea id="environment" placeholder="deep matte crimson background, reflective floor"></textarea></div>
      </fieldset>

      <fieldset><legend>Composition &amp; Framing</legend>
        <div class="row"><label>Composition</label><textarea id="composition" placeholder="mid frame crop, generous negative space"></textarea></div>
        <div class="row"><label>Lens</label><textarea id="lens" placeholder="85 mm portrait, tilt-shift look, low angle"></textarea></div>
      </fieldset>

      <fieldset><legend>Lighting</legend>
        <div class="row"><label>Lighting</label><textarea id="lighting" placeholder="balanced key light with soft diffusion"></textarea></div>
        <div class="row"><label>Contrast</label><textarea id="contrast" placeholder="no hard shadows, smooth gradient"></textarea></div>
      </fieldset>

      <fieldset><legend>Style &amp; Realism</legend>
        <div class="row">
          <label>Realism</label>
          <select id="realism">
            <option>(none)</option>
            <option>photorealistic</option>
            <option>hyperrealistic</option>
            <option>editorial realism</option>
            <option>stylized</option>
            <option>surreal</option>
          </select>
          <div class="dd98" data-for="realism"></div>
        </div>
        <div class="row"><label>Style</label><textarea id="style" placeholder="luxury fashion campaign, controlled minimalism"></textarea></div>
      </fieldset>

      <fieldset><legend>Details &amp; Negatives</legend>
        <div class="row"><label>Details</label><textarea id="details" placeholder="focus on rhythm and spacing, pristine texture detail"></textarea></div>
        <div class="row"><label>Avoid</label><textarea id="avoid" placeholder="text, watermark, clutter, props"></textarea></div>
      </fieldset>

      <fieldset><legend>Platform Optimizer</legend>
        <div class="row"><label>Platform</label>
          <select id="platform">
            <option>Generic</option>
            <option>Midjourney</option>
            <option>Stable Diffusion</option>
            <option>Flux</option>
            <option>ChatGPT Images</option>
          </select>
          <div class="dd98" data-for="platform"></div>
        </div>
      </fieldset>
      
      <!-- Action Buttons moved to bottom toolbar -->
    </div>

    <!-- Tablet/Mobile inline actions (shown only <=1180px) -->
    <div class="action-inline-mobile">
      <div class="action-buttons">
        <button class="button" onclick="clearAll()">Clear All</button>
        <button class="button" onclick="applyTemplate('fashion')">Fill Demo</button>
        <button class="button" onclick="copyPrompt()">Copy</button>
      </div>
    </div>

    <!-- Right -->
    <div class="right">
      <fieldset><legend>Master Prompt • Live Preview</legend>
        <div id="preview" class="panel panel-preview" style="white-space:pre-wrap;"></div>
      </fieldset>

      <fieldset><legend>Prompt Structure (reference)</legend>
        <div class="panel panel-structure">
Subject → Action → Setting → Environment → Composition → Lens → Lighting → Contrast → Style → Realism → Details → Avoid
        </div>
      </fieldset>

      <fieldset><legend>Model Options Cheatsheet</legend>
        <div id="cheatsheet" class="panel panel-cheatsheet" style="white-space:pre-wrap;"></div>
      </fieldset>
    </div>
  </div>

  <!-- Bottom Toolbar (global actions) -->
  <div class="action-toolbar">
    <div class="action-buttons">
      <button class="button" id="btnClear">Clear All</button>
      <button class="button" id="btnFillDemo">Fill Demo</button>
      <button class="button" id="btnCopy">Copy</button>
    </div>
  </div>

  <!-- Status -->
  <div class="status-bar">
    <div>Status <span id="status">Ready</span></div>
    <div>Autosave on</div>
  </div>
  </div>
</div>

<!-- About Modal -->
<div id="aboutModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:10000;">
  <div class="window" style="width:min(480px, 90vw); max-width:480px; margin:0;">
    <div class="title-bar">
      <div class="title-bar-text">App Info</div>
      <div class="title-bar-controls">
        <button aria-label="Close" id="aboutClose"></button>
      </div>
    </div>
    <div class="window-body" style="padding: 20px 35px; text-align:center; line-height:1.5; font-size: 13px; font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
      <p style="font-weight: 600; font-size: 13px;">Prompt Architect — Modular Master Prompt Builder</p>
      <p>
        <a href="https://www.instagram.com/xcyvc/" target="_blank" rel="noopener" style="color:#000080; text-decoration:underline;">Emir Can Yilmaz</a>
        • Entwurf III • Prof. Felix Dölker
      </p>
      <p>Hochschule Darmstadt — <a href="https://design.h-da.de" target="_blank" rel="noopener" style="color:#000080; text-decoration:underline;">Faculty of Design</a></p>
      <p style="opacity: 0.8;">Winter semester 2025/26</p>
    </div>
  </div>
</div>

<!-- Guide Modal -->
<div id="guideModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:10000;">
  <div class="window" style="width:min(600px, 90vw); max-width:600px; max-height:80vh; display:flex; flex-direction:column; margin:0;">
    <div class="title-bar">
      <div class="title-bar-text">Prompt Structure Guide</div>
      <div class="title-bar-controls">
        <button aria-label="Close" id="guideClose"></button>
      </div>
    </div>
    <div class="window-body" style="padding:20px; overflow-y:auto; line-height:1.5; font-size: 13px; text-align:left; font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
      <p>This guide explains how to turn ideas into a portable, model-agnostic master prompt. Write in natural English without special tokens. Lead with the subject and a clear action so the model anchors composition.</p>
      <ul style="margin:12px 0 12px 20px; padding:0;">
        <li style="margin:6px 0;"><strong>Subject + action</strong> — what appears and how it behaves.</li>
        <li style="margin:6px 0;"><strong>Setting + environment</strong> — place, palette, materials, atmosphere.</li>
        <li style="margin:6px 0;"><strong>Composition + framing</strong> — crop, scale, negative space; add a short <em>lens / perspective</em> hint.</li>
        <li style="margin:6px 0;"><strong>Lighting + exposure</strong> — mood, softness vs. hardness, gradients, shadow behavior.</li>
        <li style="margin:6px 0;"><strong>Aesthetic + realism</strong> — look and fidelity (e.g., editorial realism, stylized, hyperrealistic).</li>
        <li style="margin:6px 0;"><strong>Details</strong> — micro-focus like texture, edge quality, color separation.</li>
        <li style="margin:6px 0;"><strong>Negatives</strong> — remove text, watermarks, clutter, brand marks.</li>
      </ul>
      <p>Prefer short, concrete sentences; avoid redundant synonyms. Two to four decisive attributes per module are enough. Leave platform flags out of the prompt; use the <em>Model Options Cheatsheet</em> in the main window to append platform-specific parameters manually.</p>
    </div>
  </div>
</div>

    <script>
      /* ---------- auto-resize textareas ---------- */
function autoResizeTextarea(textarea) {
  const minHeight = 30;
  
  // Reset to minimum height
  textarea.style.height = minHeight + 'px';
  
  // Get the scroll height (content height)
  const scrollHeight = textarea.scrollHeight;
  
  // Set to scrollHeight if content exceeds minimum
  if (scrollHeight > minHeight) {
    textarea.style.height = scrollHeight + 'px';
  }
}

// Apply auto-resize to all textareas
document.querySelectorAll('textarea').forEach(textarea => {
  // Resize on input
  textarea.addEventListener('input', function() {
    autoResizeTextarea(this);
  });
  // Resize on paste
  textarea.addEventListener('paste', function() {
    setTimeout(() => autoResizeTextarea(this), 10);
  });
  // Initial resize
  setTimeout(() => autoResizeTextarea(textarea), 100);
});

// Re-run after template is applied
const originalApplyTemplate = window.applyTemplate;
if (originalApplyTemplate) {
  window.applyTemplate = function() {
    originalApplyTemplate.apply(this, arguments);
    setTimeout(() => {
      document.querySelectorAll('textarea').forEach(textarea => {
        autoResizeTextarea(textarea);
      });
    }, 100);
  };
}

/* ---------- helpers ---------- */
const $ = (id)=>document.getElementById(id);
const fieldIds = ["subject","action","altNames","setting","environment","composition","lens","lighting","contrast","style","realism","details","avoid","platform"];
const preview = $("preview"), cheatsheet = $("cheatsheet"), statusEl = $("status");
function setStatus(s){ statusEl.textContent = s; }

function splitPhrases(s){ return (s||"").replace(/[.;]+/g,",").split(",").map(x=>x.trim()).filter(Boolean); }
function joinPhrases(arr){ const seen=new Set(), out=[]; for(const x of arr){ const k=x.toLowerCase(); if(!seen.has(k)){ seen.add(k); out.push(x); } } return out.join(", "); }
function normalizeInline(s){ return (s||"").replace(/\s+/g," ").replace(/\s*,\s*/g,", ").replace(/\s*\.\s*/g,". ").trim(); }

function getState(){ const s={}; fieldIds.forEach(k=>s[k]=($(k)?.value||"").trim()); return s; }
function setState(s){ 
  fieldIds.forEach(k=>{ 
    if(s[k]!=null && $(k)) {
      $(k).value=s[k];
      // Trigger change event to update custom dropdowns
      $(k).dispatchEvent(new Event('change', {bubbles:true}));
    }
  }); 
  build(); 
}

/* ---------- cheatsheet ---------- */
function normalizePlatform(v){
  const s = (v || '').toLowerCase();
  if(s.includes('midjourney')) return 'midjourney';
  if(s.includes('stable')) return 'stable diffusion';
  if(s.includes('flux')) return 'flux';
  if(s.includes('chatgpt')) return 'chatgpt images';
  return 'generic';
}

function modelOptionsHelp(platformRaw){
  const platform = normalizePlatform(platformRaw);
  if(platform === 'midjourney'){
    return [
      'Midjourney options:',
      '• --v 6 or 5.2 → model version',
      '• --ar 1:1 | 4:5 | 3:2 | 16:9 → aspect ratio',
      '• --stylize 0–1000 → style strength (100≈balanced)',
      '• --quality 0.25 | 0.5 | 1 | 2 → render quality/time',
      '• --chaos 0–100 → variation/randomness',
      'Tip: Append parameters after the narrative, e.g. "… clean gradient background" --v 6 --ar 4:5 --stylize 100 --quality 1'
    ].join('\n');
  }
  if(platform === 'stable diffusion'){
    return [
      'Stable Diffusion (SDXL) hints:',
      '• Pick 1024×1536 or 1536×1024 depending on orientation',
      '• Guidance/CFG around 6–8 balances fidelity and freedom',
      '• Samplers: DPM++ 2M Karras (crisp), Euler a (looser), UniPC (fast)',
      '• Use short sentences; avoid stacked keyword spam'
    ].join('\n');
  }
  if(platform === 'flux'){
    return [
      'Flux notes:',
      '• Prefer long edge ≈1536 for detail',
      '• Be explicit about palette and separation (clean, restrained, high separation)',
      '• Great for architecture, product, graphic subjects'
    ].join('\n');
  }
  if(platform === 'chatgpt images'){
    return [
      'ChatGPT Images tips:',
      '• Full sentences, natural English only',
      '• No flags or command tokens',
      '• Name lens, light, style, mood in one flowing paragraph'
    ].join('\n');
  }
  return [
    'Generic diffusion guidance:',
    '• One paragraph of natural language',
    '• Subject → setting → composition → light → style → details → negatives',
    '• Keep portable: no platform flags in the prompt'
  ].join('\n');
}

/* ---------- builder ---------- */
function cap(s){ return s ? s.charAt(0).toUpperCase() + s.slice(1) : s; }

function build(){
  const p=getState(); 
  const lines=[];
  
  // Subject + Action with optional realism
  if(p.subject){
    const realism = (p.realism && p.realism!=="(none)") ? ` ${p.realism}` : "";
    lines.push(cap(`a high-end${realism} studio photograph of ${p.subject}${p.action ? `, ${p.action}` : ""}`));
  }
  
  // Alt-names
  if(p.altNames) lines.push(p.altNames);
  
  // Setting + Environment
  if(p.setting || p.environment){
    const env = [p.setting, p.environment].filter(Boolean).join(", ");
    lines.push(`set in ${env}`);
  }
  
  // Composition + Lens
  if(p.composition || p.lens){
    const comp = [p.composition, p.lens].filter(Boolean).join(", ");
    lines.push(`with a composition that favors ${comp}`);
  }
  
  // Lighting + Contrast
  if(p.lighting || p.contrast){
    const light = [p.lighting, p.contrast].filter(Boolean).join(", ");
    lines.push(`lit by ${light}`);
  }
  
  // Style + Realism aesthetic
  if(p.style || (p.realism && p.realism!=="(none)")){
    const aesth = [p.style, (p.realism && p.realism!=="(none)" ? p.realism : "")].filter(Boolean).join(", ");
    if(aesth) lines.push(`an overall aesthetic of ${aesth}`);
  }
  
  // Details
  if(p.details) lines.push(p.details.replace(/\.$/,""));
  
  // Avoid
  if(p.avoid) lines.push(`avoid ${p.avoid}`);

  // Join and clean up
  let out = lines.filter(Boolean).map(s => s.replace(/\s+/g, " ").trim()).join(". ");
  
  // Natural language flow improvements
  out = out
    .replace(/\. with a /g, ", with a ")
    .replace(/\. lit by /g, ", lit by ")
    .replace(/\. set in /g, ", set in ")
    .replace(/, an overall aesthetic of /g, ". The overall aesthetic reads ");
  
  // Ensure proper ending punctuation
  if(out && !/[.!?]$/.test(out)) out += ".";
  
  // Update displays
  preview.textContent = out;
  cheatsheet.textContent = modelOptionsHelp(p.platform);
  
  return out;
}

/* ---------- actions ---------- */
function clearAll(){ 
  fieldIds.forEach(k=>{
    $(k).value="";
    // Trigger change event to update custom dropdowns
    $(k).dispatchEvent(new Event('change', {bubbles:true}));
  }); 
  // Reset platform and realism to defaults
  $("platform").value = "Generic";
  $("realism").value = "(none)";
  $("platform").dispatchEvent(new Event('change', {bubbles:true}));
  $("realism").dispatchEvent(new Event('change', {bubbles:true}));
  
  // Reset all textarea heights to default
  setTimeout(() => {
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.style.height = '30px';
      // Force reflow
      textarea.offsetHeight;
    });
  }, 50);
  
  build(); 
  setStatus("Cleared"); 
  saveState(); 
}
async function copyPrompt(){ 
  const txt=$("preview").textContent || build(); 
  try{ 
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(txt); 
      setStatus("Copied"); 
    } else {
      // Fallback for older browsers/devices
      const textArea = document.createElement("textarea");
      textArea.value = txt;
      textArea.style.position = "fixed";
      textArea.style.left = "-999999px";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        document.execCommand('copy');
        setStatus("Copied");
      } catch(err) {
        setStatus("Copy failed");
      }
      document.body.removeChild(textArea);
    }
  }catch{ 
    setStatus("Copy failed"); 
  } 
}
function exportTxt(){ const blob=new Blob([build()],{type:"text/plain"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url;a.download="master-prompt.txt"; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); setStatus("Exported"); }
function normalize(){ ["subject","action","altNames","setting","environment","composition","lens","lighting","contrast","style","details","avoid"].forEach(id=>{ const v=normalizeInline($(id).value||""); $(id).value=joinPhrases(splitPhrases(v)); }); build(); setStatus("Normalized"); saveState(); }
function tighten(){
  const fluff=/\b(crisp|clean|nice|beautiful|amazing|stunning|gorgeous|incredible|really|very|quite|extremely|super|ultra)\b/ig;
  const cap=(id,n)=>{ let items=splitPhrases(normalizeInline($(id).value||"")).map(s=>s.replace(fluff,"").replace(/\s{2,}/g," ").trim()).filter(Boolean); $(id).value=joinPhrases(items.slice(0,n)); };
  cap("style",3); cap("details",4); cap("composition",3); cap("lighting",3); cap("contrast",2); cap("altNames",3);
  build(); setStatus("Tightened"); saveState();
}
function expand(){
  const ctx=["subject","altNames","setting","environment","style"].map(id=>($(id).value||"").toLowerCase()).join(" ");
  const add=(id,toks)=>{ const cur=splitPhrases($(id).value||""); const have=new Set(cur.map(x=>x.toLowerCase())); toks.forEach(t=>{ if(t && !have.has(t.toLowerCase())) cur.push(t); }); $(id).value=joinPhrases(cur); };
  if(ctx.includes("model")||ctx.includes("fashion")){ add("composition",["mid-frame crop with symmetry"]); add("lighting",["soft diffusion key","subtle rim for separation"]); add("details",["visible fabric weave","clean silhouette"]); }
  else if(ctx.includes("bottle")||ctx.includes("product")){ add("composition",["centerline pack hero"]); add("lighting",["controlled speculars"]); add("details",["dust-free surfaces","label legibility"]); }
  else{ add("composition",["measured negative space"]); add("lighting",["gentle gradient background"]); add("details",["refined edge quality"]); }
  ["composition","lighting","details","style"].forEach(id=>$(id).value=joinPhrases(splitPhrases(normalizeInline($(id).value||""))));
  build(); setStatus("Expanded"); saveState();
}
function randomize(){
  const moods=["serene mood","melancholic mood","vivid mood","austere mood","ethereal mood","tense mood"];
  const cur=$("style").value.toLowerCase(); const pool=moods.filter(m=>!cur.includes(m.split(" ")[0])); const pick=(pool.length?pool:moods)[Math.floor(Math.random()*moods.length)];
  $("style").value=$("style").value?($("style").value+", "+pick):pick; build(); setStatus("Mood randomized"); saveState();
}

/* ---------- templates ---------- */
function applyTemplate(key){
  const T={
    editorial:{subject:"modern perfume bottle",action:"standing on a small plinth",altNames:"glass refraction, clean label",setting:"studio",environment:"matte light gray sweep with reflective acrylic floor",composition:"centered with generous negative space",lens:"85 mm equivalent",lighting:"soft key from left with gentle rim",contrast:"medium contrast with soft shadows",style:"editorial product aesthetic, controlled minimalism",realism:"(none)",details:"subtle condensation on glass, high color separation",avoid:"watermark, hands, clutter",platform:"Generic"},
    fashion:{subject:"Dalmatian dog",action:"standing and partially cropped",altNames:"black and white spotted coat with clear tonal separation",setting:"studio backdrop",environment:"deep matte crimson red with a smooth and shadowless gradient",composition:"mid frame crop with centered alignment and precise symmetry",lens:"85 mm lens equivalent",lighting:"balanced studio key light with soft diffusion",contrast:"no hard shadows and gentle falloff across the background",style:"luxury fashion campaign and controlled minimalism and graphic realism",realism:"editorial realism",details:"visual focus on the rhythm and spacing of the Dalmatian spots, a dialogue between organic irregularity and geometric order, atmosphere of quiet tension and architectural balance and pristine texture detail",avoid:"text and watermark and background distractions",platform:"Generic"},
    architectural:{subject:"brutalist office building",action:"seen from street level",altNames:"ribbed concrete, deep reveals",setting:"city block",environment:"overcast sky",composition:"one-point perspective with generous negative space",lens:"35 mm equivalent, slight low angle",lighting:"soft daylight, diffuse contrast",contrast:"no harsh speculars",style:"architectural reportage",realism:"(none)",details:"sharp edges, clean lines",avoid:"people, cars, logos",platform:"Generic"},
    artistic:{subject:"abstract paper sculpture",action:"floating composition",altNames:"folds, cuts, layered textures",setting:"studio",environment:"matte charcoal sweep with soft haze",composition:"asymmetric balance with strong diagonals",lens:"50 mm equivalent",lighting:"rim from back right, soft key fill",contrast:"deep blacks with velvet highlights",style:"artistic concept piece, graphic minimalism",realism:"(none)",details:"fine fiber texture, tactile edges",avoid:"text, watermark, props",platform:"Generic"},
    lifestyle:{subject:"ceramic mug on wooden table",action:"steam rising",altNames:"morning coffee",setting:"home interior",environment:"window light with plants in the background",composition:"rule of thirds with shallow depth",lens:"35 mm",lighting:"soft daylight from side",contrast:"gentle highlights",style:"cozy lifestyle",realism:"(none)",details:"wood grain detail, ceramic glaze",avoid:"brand logos",platform:"Generic"}
  };
  if(!T[key]) return;
  setState(T[key]); 
  setStatus(key === "fashion" ? "Demo filled in" : "Template applied: "+key); 
  saveState(); 
  pushHistory();
}

/* ---------- undo/redo ---------- */
const HISTORY_MAX=50; let historyStack=[], redoStack=[];
function snapshot(){ return JSON.stringify(getState()); }
function pushHistory(){ historyStack.push(snapshot()); if(historyStack.length>HISTORY_MAX) historyStack.shift(); redoStack.length=0; }
function undo(){ if(!historyStack.length) return; const cur=snapshot(); const prev=historyStack.pop(); redoStack.push(cur); setState(JSON.parse(prev)); setStatus("Undo"); }
function redo(){ if(!redoStack.length) return; const cur=snapshot(); const next=redoStack.pop(); historyStack.push(cur); setState(JSON.parse(next)); setStatus("Redo"); }

/* ---------- autosave ---------- */
const LS_KEY="prompt-architect-state";
function saveState(){ localStorage.setItem(LS_KEY, snapshot()); }
function restoreState(){ const raw=localStorage.getItem(LS_KEY); if(!raw) return; try{ setState(JSON.parse(raw)); setStatus("Status Restored"); }catch{} }

/* ---------- bind inputs ---------- */
fieldIds.forEach(id=>{
  const el=$(id); if(!el) return;
  el.addEventListener("input", ()=>{ build(); saveState(); setStatus("Editing…"); });
  el.addEventListener("change", ()=> pushHistory());
});

/* ---------- bottom buttons ---------- */
$("btnClear").addEventListener("click", clearAll);
$("btnFillDemo").addEventListener("click", ()=>applyTemplate("fashion"));
$("btnCopy").addEventListener("click", copyPrompt);

/* ---------- modals ---------- */
const aboutModal = document.getElementById("aboutModal");
const guideModal = document.getElementById("guideModal");
const aboutClose = document.getElementById("aboutClose");
const guideClose = document.getElementById("guideClose");
const mainTitleBar = document.querySelector(".window > .title-bar");
const aboutTitleBar = aboutModal.querySelector('.title-bar');
const guideTitleBar = guideModal.querySelector('.title-bar');

function openAbout(){
  aboutModal.style.zIndex = 10001;
  guideModal.style.zIndex = 10000;
  aboutModal.style.display = "block";
  mainTitleBar.classList.add("inactive");
  aboutTitleBar.classList.remove("inactive");
  guideTitleBar.classList.add("inactive");
}
function closeAbout(){
  aboutModal.style.display = "none";
  if (guideModal.style.display === 'block') {
    guideTitleBar.classList.remove("inactive");
  } else {
    mainTitleBar.classList.remove("inactive");
  }
}
function openGuide(){
  guideModal.style.zIndex = 10001;
  aboutModal.style.zIndex = 10000;
  guideModal.style.display = "block";
  mainTitleBar.classList.add("inactive");
  guideTitleBar.classList.remove("inactive");
  aboutTitleBar.classList.add("inactive");
}
function closeGuide(){
  guideModal.style.display = "none";
  if (aboutModal.style.display === 'block') {
    aboutTitleBar.classList.remove("inactive");
  } else {
    mainTitleBar.classList.remove("inactive");
  }
}

aboutClose.addEventListener("click", closeAbout);
guideClose.addEventListener("click", closeGuide);

/* ---------- menus ---------- */
document.querySelectorAll("[data-menu]").forEach(menu=>{
  const btn=menu.querySelector("[data-toggle]");
  btn.addEventListener("click",(e)=>{ document.querySelectorAll(".menu").forEach(m=>m!==menu&&m.classList.remove("open")); menu.classList.toggle("open"); e.stopPropagation(); });
});
document.addEventListener("click",()=>document.querySelectorAll(".menu").forEach(m=>m.classList.remove("open")));
document.querySelectorAll(".item").forEach(it=>{
  const a=it.dataset.action, tpl=it.dataset.tpl;
  it.addEventListener("click",()=>{
    if(tpl) return applyTemplate(tpl);
    switch(a){
      case "new": clearAll(); break;
      case "save": exportTxt(); break;
      case "copy": copyPrompt(); break;
      case "about": openAbout(); break;
      case "undo": undo(); break;
      case "redo": redo(); break;
      case "normalize": normalize(); break;
      case "tighten": tighten(); break;
      case "expand": expand(); break;
      case "randomize": randomize(); break;
      case "guide": openGuide(); break;
    }
    document.querySelectorAll(".menu").forEach(m=>m.classList.remove("open"));
  });
});

/* ---------- shortcuts ---------- */
function isMac(){ return /Mac|iPhone|iPad/.test(navigator.platform); }
document.addEventListener("keydown",(e)=>{
  const mod=isMac()?e.metaKey:e.ctrlKey; if(!mod) return;
  const k=e.key.toLowerCase();
  if(["n","s","c","i","z","y","l","t","e","r","1","2","3","4","5","h"].includes(k)) e.preventDefault();
  if(k==="n") clearAll();
  if(k==="s") exportTxt();
  if(k==="c") copyPrompt();
  if(k==="i") alert("Prompt Architect — Windows 98 Edition");
  if(k==="z") undo();
  if(k==="y") redo();
  if(k==="l") normalize();
  if(k==="t") tighten();
  if(k==="e") expand();
  if(k==="r") randomize();
  if(k==="1") applyTemplate("editorial");
  if(k==="2") applyTemplate("fashion");
  if(k==="3") applyTemplate("architectural");
  if(k==="4") applyTemplate("artistic");
  if(k==="5") applyTemplate("lifestyle");
  if(k==="h") alert("Prompt Structure Guide\n\nSubject → Action → Setting → Environment → Composition → Lens → Lighting → Contrast → Style → Realism → Details → Avoid");
});

/* ---------- maximize ---------- */
const btnMaximize = document.getElementById("btnMaximize");
const windowEl = document.querySelector(".window");
if(btnMaximize && windowEl){
  btnMaximize.addEventListener("click", ()=>{
    windowEl.classList.toggle("maximized");
    updateMaximizeVisibility();
    updateRightSizing();
  });
}

/* ---------- close tab (best-effort, cross-device) ---------- */
function closeCurrentTab(){
  // 1) Try standard close
  window.close();
  // 2) Some browsers allow this variant
  try { window.open('', '_self').close(); } catch(e) {}

  // 3) Fallbacks: navigate away if blocking close
  setTimeout(()=>{
    // If still open, try history back
    if (document.visibilityState !== 'hidden'){
      if (history.length > 1){
        history.back();
        // After going back, if still here, blank out
        setTimeout(()=>{
          if (document.visibilityState !== 'hidden'){
            location.replace('about:blank');
          }
        }, 300);
      } else {
        location.replace('about:blank');
      }
    }
  }, 150);
}

const mainCloseBtn = document.getElementById('mainClose');
if(mainCloseBtn){
  mainCloseBtn.addEventListener('click', (e)=>{ e.preventDefault(); closeCurrentTab(); });
}

/* Show maximize only on desktop when growth is available, or when in maximized state (to allow restore) */
function updateMaximizeVisibility(){
  const btn = document.getElementById('btnMaximize');
  const win = document.querySelector('.window');
  if(!btn || !win) return;

  // Hide on tablet/mobile via CSS media query; JS guards too
  const isMobile = window.matchMedia('(max-width: 1180px)').matches;
  if(isMobile){ btn.style.display = 'none'; return; }

  const rect = win.getBoundingClientRect();
  const pad = 24; // outer margin/gap accounted in layout
  const availW = Math.max(0, (window.innerWidth || rect.width) - pad);
  const availH = Math.max(0, (window.innerHeight || rect.height) - pad);
  const canGrowW = (availW - Math.round(rect.width)) > 12;
  const canGrowH = (availH - Math.round(rect.height)) > 12;
  const isMax = win.classList.contains('maximized');

  // Show if there is room to maximize, or if currently maximized (to allow restore)
  if(isMax || canGrowW || canGrowH){
    btn.style.display = '';
  } else {
    btn.style.display = 'none';
  }
}

/* When the right column overflows on desktop, reduce the reference panel height.
   Uses hysteresis so state doesn't flip when content (e.g., platform cheatsheet) changes slightly. */
let RIGHT_TIGHT = null; // null=unknown, true=tight, false=normal
function updateRightSizing(){
  const right = document.querySelector('.grid .right');
  if(!right) return;
  const isDesktop = window.matchMedia('(min-width: 1181px)').matches;
  if(!isDesktop){
    RIGHT_TIGHT = null;
    right.classList.remove('right-tight');
    return;
  }
  const overflow = right.scrollHeight - right.clientHeight; // >0 means needs scroll
  const ADD_THRESHOLD = 40;    // only enter tight mode if overflow is meaningfully large
  const RELEASE_SLACK = 60;    // only leave tight mode if plenty of free space comes back
  let next = RIGHT_TIGHT;
  if(next === null){
    // Initialize once; prefer tight if overflow exists
    next = overflow > 2;
  } else if(next === false){
    if(overflow > ADD_THRESHOLD) next = true;
  } else if(next === true){
    const slack = right.clientHeight - right.scrollHeight; // negative if overflow
    if(slack >= RELEASE_SLACK) next = false;
  }
  RIGHT_TIGHT = next;
  right.classList.toggle('right-tight', !!next);
}

/* ---------- init ---------- */
restoreState();
// Reset platform and realism to defaults on every load
$("platform").value = "Generic";
$("realism").value = "(none)";
build();
pushHistory();
updateMaximizeVisibility();
window.addEventListener('resize', updateMaximizeVisibility);
window.addEventListener('orientationchange', updateMaximizeVisibility);
// Keep right-column sizing responsive
updateRightSizing();
window.addEventListener('resize', updateRightSizing);
window.addEventListener('orientationchange', updateRightSizing);
// Reset zoom on mobile when keyboard closes and auto-expand inputs
if(window.innerWidth <= 1180){
  const viewportMeta = document.querySelector('meta[name=viewport]');
  
  // Auto-expand function for inputs
  function autoExpand(el){
    if(el.tagName === 'TEXTAREA'){
      el.style.height = 'auto';
      el.style.height = el.scrollHeight + 'px';
    } else if(el.tagName === 'INPUT'){
      // For inputs with long text, allow wrapping
      const textLength = el.value.length;
      if(textLength > 50){
        el.style.height = 'auto';
        const lines = Math.ceil(textLength / 40);
        el.style.height = Math.max(22, lines * 20) + 'px';
      }
    }
  }
  
  document.querySelectorAll('input, textarea, select').forEach(el => {
    el.addEventListener('focus', () => {
      viewportMeta.content = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no';
    });
    el.addEventListener('blur', () => {
      viewportMeta.content = 'width=device-width, initial-scale=1';
    });
    // Auto-expand on input
    if(el.tagName === 'TEXTAREA' || el.tagName === 'INPUT'){
      el.addEventListener('input', () => autoExpand(el));
      // Initial expand
      autoExpand(el);
    }
  });
}
/* ---------- desktop custom dropdowns for realism & platform ---------- */
function buildDD98(forId){
  const sel = document.getElementById(forId);
  const host = document.querySelector('.dd98[data-for="'+forId+'"]');
  if(!sel || !host) return;
  host.innerHTML = '';
  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'dd98-btn';
  const label = document.createElement('span');
  label.className = 'dd-label';
  const caret = document.createElement('span');
  caret.className = 'dd-caret';
  const ul = document.createElement('ul');
  ul.className = 'dd98-menu';
  // Populate items from select options
  const options = Array.from(sel.options);
  options.forEach(opt => {
    const li = document.createElement('li');
    li.textContent = opt.textContent;
    li.setAttribute('data-val', (opt.getAttribute('value') ?? opt.textContent));
    li.setAttribute('aria-selected', opt.selected ? 'true' : 'false');
    li.addEventListener('click', (e)=>{
      e.preventDefault(); e.stopPropagation();
      sel.value = (opt.getAttribute('value') ?? opt.textContent);
      // update selected marks
      ul.querySelectorAll('li').forEach(x=>x.setAttribute('aria-selected','false'));
      li.setAttribute('aria-selected','true');
      label.textContent = opt.textContent;
      host.classList.remove('open','up');
      // propagate events to existing listeners
      sel.dispatchEvent(new Event('input', {bubbles:true}));
      sel.dispatchEvent(new Event('change', {bubbles:true}));
    });
    ul.appendChild(li);
  });
  const current = options.find(o=>o.selected) || options[0];
  label.textContent = current ? current.textContent : '';
  btn.appendChild(label);
  btn.appendChild(caret);
  host.appendChild(btn);
  host.appendChild(ul);
  // Keep label in sync if the hidden select changes programmatically
  sel.addEventListener('change', ()=>{
    const v = sel.value;
    const found = Array.from(ul.querySelectorAll('li')).find(li=>li.getAttribute('data-val')==v);
    if(found){
      ul.querySelectorAll('li').forEach(x=>x.setAttribute('aria-selected','false'));
      found.setAttribute('aria-selected','true');
      label.textContent = found.textContent;
    }
  });
  // Open/close + direction
  const toggle = (e)=>{
    e.preventDefault(); e.stopPropagation();
    const isOpen = host.classList.contains('open');
    document.querySelectorAll('.dd98.open').forEach(d=>d!==host&&d.classList.remove('open','up'));
    if(isOpen){ host.classList.remove('open','up'); return; }
    // decide direction
    host.classList.remove('up');
    if(forId === 'platform'){
      host.classList.add('up');
    }
    host.classList.add('open');
  };
  btn.addEventListener('click', toggle);
}
function applyDD98(){
  const isDesktop = window.matchMedia('(min-width: 1181px)').matches;
  const ids = ['realism','platform'];
  ids.forEach(id=>{
    const sel = document.getElementById(id);
    const host = document.querySelector('.dd98[data-for="'+id+'"]');
    if(!sel || !host) return;
    if(isDesktop){
      host.style.display = 'block';
      buildDD98(id);
    } else {
      host.style.display = 'none';
    }
  });
}
applyDD98();
window.addEventListener('resize', applyDD98);
window.addEventListener('orientationchange', applyDD98);
document.addEventListener('click', ()=>{ document.querySelectorAll('.dd98.open').forEach(d=>d.classList.remove('open','up')); });

    </script>
</body>
</html>
